package nape.callbacks;
$(import);

Flags(CbEvent,
	prop(BEGIN,0)
	prop(END,1)
	
	prop(WAKE,2)
	prop(SLEEP,3)
	
	prop(BREAK,4)

	prop(PRE_BEGIN,5)
	prop(PRE_ONGOING,6)
)

class Callback {
	public var pr(inner):PR(Callback);

    property(event,CbEvent,{
        [CbEvent.BEGIN,CbEvent.END,CbEvent.WAKE,CbEvent.SLEEP,CbEvent.BREAK][pr(inner).event];
    })

    ///---------------------------------------------------------------------------------------------

    property(arbiter,Arbiter,{
		pr(inner).arbiter == null ? null : pr(inner).arbiter.wrapper();
    })

    property(body,Body,{
        pr(inner).body == null ? null : pr(inner).body.outer;
    })

    property(constraint,Constraint,{
        pr(inner).constraint == null ? null : pr(inner).constraint.outer;
    })

    ///---------------------------------------------------------------------------------------------

    property(listener,Listener,{
        pr(inner).listener.outer;
    })

    ///---------------------------------------------------------------------------------------------
	
	public function new() {
		DEBUG(if(!PR(Callback).internal) throw "Error: Callback cannot be instantiated derp!";)
	}

    ///---------------------------------------------------------------------------------------------

    @:$keep public inline function toString() {
        var ret = "Cb:";
        ret += ["BEGIN","END","WAKE","SLEEP","BREAK","PRE_BEGIN","PRE_ONGOING"][pr(inner).event];
        if(pr(inner).event==Flag(CbEvent,WAKE) || pr(inner).event==Flag(CbEvent,SLEEP))
            ret += ":"+(body!=null ? body.toString() : constraint.toString());
        ret += " : listener: "+listener;
        return ret;
    }
}
